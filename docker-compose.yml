services:
  # Wallet OS 应用服务
  # Wallet OS application service
  wallet-os:
    # 构建配置
    # Build configuration
    build: 
      context: .
      dockerfile: Dockerfile
    
    # 端口映射
    # Port mapping
    # 将宿主机的 8081 端口映射到容器的 80 端口
    # Map host port 8081 to container port 80
    ports:
      - "8081:80"
    
    # 数据卷挂载
    # Volume mounting
    # 1. wallet_os_data:/app/data -> 持久化存储数据库文件，防止重启丢失数据
    #    Persist database file to avoid data loss on restart
    # 3. ./logs:/app/logs -> 挂载日志目录，将容器内的日志保存到宿主机
    #    Mount logs directory to save container logs to host
    volumes:
      - ./wallet_os_data:/app/data
      - ./static:/app/static
      - ./logs:/app/logs
    
    # 环境变量配置
    # Environment variables
    # 指定数据库文件的存放位置（需与上面的 volumes 挂载路径对应）
    # Specify database file location (must match volume mount path)
    environment:
      - DATABASE_URL=sqlite:/app/data/wallet-os.db
    
    # 加载外部环境变量文件 (用于 AI 配置)
    # Load external environment file (for AI config)
    env_file:
      - ai-assistant-api.env
    
    # 重启策略
    # Restart policy
    # 除非被手动停止，否则自动重启（例如崩溃或系统重启后）
    # Automatically restart unless explicitly stopped
    restart: unless-stopped

# 定义命名数据卷
# Define named volumes
volumes:
  wallet_os_data:
