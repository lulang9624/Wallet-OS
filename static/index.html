<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wallos Next</title>
    <style>
        /* 定义 CSS 变量，便于主题管理 */
        /* Define CSS variables for theme management */
        :root {
            --bg-color: #1a1a1a;
            --card-bg: #2d2d2d;
            --text-color: #e0e0e0;
            --accent: #4caf50;
        }
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
        }
        /* 响应式容器 */
        /* Responsive container */
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        h1 { text-align: center; }
        /* 通用按钮样式 */
        /* Common button styles */
        .btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
        }
        /* 订阅卡片样式 */
        /* Subscription card styles */
        .sub-card {
            background: var(--card-bg);
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .sub-info h3 { margin: 0 0 5px 0; }
        .sub-price { font-size: 1.2rem; font-weight: bold; color: var(--accent); }
        /* 模态框样式 */
        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7);
        }
        .modal-content {
            background: var(--card-bg);
            margin: 10% auto;
            padding: 20px;
            width: 90%;
            max-width: 500px;
            border-radius: 10px;
        }
        input, select {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            background: #3d3d3d;
            border: none;
            color: white;
            border-radius: 5px;
        }
        /* 统计数据网格布局 */
        /* Stats grid layout */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-box {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        .stat-box h3 { color: #aaa; font-size: 0.9rem; margin-top: 0; }
        .stat-box .value { font-size: 2rem; font-weight: bold; color: var(--accent); }
    </style>
</head>
<body>
    <div class="container">
        <h1>Wallet OS</h1>
        
        <!-- 统计展示区域 -->
        <!-- Statistics display area -->
        <div class="stats-grid">
            <div class="stat-box">
                <h3>Total Monthly</h3>
                <div class="value" id="total-cost">...</div>
            </div>
            <div class="stat-box">
                <h3>Active Subs</h3>
                <div class="value" id="active-count">...</div>
            </div>
        </div>

        <div style="text-align: right; margin-bottom: 20px;">
            <button class="btn" onclick="openModal()">+ Add Subscription</button>
        </div>
        <!-- 订阅列表容器 -->
        <!-- Subscription list container -->
        <div id="subs-list">Loading...</div>
    </div>

    <!-- 添加订阅的模态框 -->
    <!-- Add subscription modal -->
    <div id="addModal" class="modal">
        <div class="modal-content">
            <h2>New Subscription</h2>
            <input type="text" id="name" placeholder="Name (e.g. Netflix)">
            <input type="number" id="price" placeholder="Price">
            <input type="text" id="currency" value="USD" placeholder="Currency">
            <select id="frequency">
                <option value="1">Monthly</option>
                <option value="12">Yearly</option>
            </select>
            <input type="date" id="next_payment">
            <button class="btn" onclick="addSubscription()">Save</button>
            <button class="btn" style="background: #666;" onclick="closeModal()">Cancel</button>
        </div>
    </div>

    <script>
        const API = '/api/subscriptions';

        // 获取并渲染订阅列表
        // Fetch and render subscription list
        async function fetchSubs() {
            const res = await fetch(API);
            const data = await res.json();
            renderStats(data);
            const list = document.getElementById('subs-list');
            list.innerHTML = '';
            data.forEach(sub => {
                let freqLabel = sub.frequency === 12 ? '/yr' : '/mo';
                list.innerHTML += `
                    <div class="sub-card">
                        <div class="sub-info">
                            <h3>${sub.name}</h3>
                            <small>Next: ${sub.next_payment || 'N/A'}</small>
                        </div>
                        <div style="text-align: right;">
                            <div class="sub-price">${sub.currency} ${sub.price}<span style="font-size:0.8rem;color:#aaa">${freqLabel}</span></div>
                            <button style="background:none; border:none; color:#f44336; cursor:pointer;" onclick="deleteSub(${sub.id})">Delete</button>
                        </div>
                    </div>
                `;
            });
        }

        // 计算并显示统计数据
        // Calculate and display statistics
        function renderStats(subs) {
            let total = 0;
            subs.forEach(sub => {
                // 如果是年付，转换为月均成本
                // If yearly payment, convert to monthly cost
                if(sub.frequency === 12) {
                    total += sub.price / 12;
                } else {
                    total += sub.price;
                }
            });
            document.getElementById('total-cost').innerText = '$' + total.toFixed(2);
            document.getElementById('active-count').innerText = subs.length;
        }

        // 添加新订阅
        // Add new subscription
        async function addSubscription() {
            const payload = {
                name: document.getElementById('name').value,
                price: parseFloat(document.getElementById('price').value),
                currency: document.getElementById('currency').value,
                next_payment: document.getElementById('next_payment').value,
                frequency: parseInt(document.getElementById('frequency').value),
                url: "",
                logo: ""
            };

            await fetch(API, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            closeModal();
            fetchSubs();
        }

        // 删除订阅
        // Delete subscription
        async function deleteSub(id) {
            if(confirm('Delete this subscription?')) {
                await fetch(`${API}/${id}`, { method: 'DELETE' });
                fetchSubs();
            }
        }

        // 模态框控制函数
        // Modal control functions
        function openModal() { document.getElementById('addModal').style.display = 'block'; }
        function closeModal() { document.getElementById('addModal').style.display = 'none'; }

        // 页面加载时获取数据
        // Fetch data on page load
        fetchSubs();
    </script>
</body>
</html>
